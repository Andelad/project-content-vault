# Bug Fix Guide

**Context**: Read `.cursorrules` (patterns), `.architecture` (locations), `.ddd` (philosophy) first

## "Look at this bug"

### Step 1: Investigate & Summarize (DON'T FIX YET)

Run these searches:
```bash
grep -r "concept" src/domain/rules/       # Business logic
grep -r "concept" src/services/orchestrators/  # Coordination
grep -r "concept" src/components/         # UI
grep -r "describe.*concept" src/**/__tests__/  # Expected behavior
```

Summarize:
1. **Business logic**: What should happen?
2. **Domain rules**: Which files? What constraints?
3. **Orchestrator**: Which file? What workflow?
4. **Component**: Which file? What UI?
5. **Tests**: What do they expect? Are any failing?
6. **Gap**: Expected vs Actual behavior

**Offer 2-3 solutions** with pros/cons. **Wait for feedback.**

---

### Step 2: Fix (After User Confirms)

1. **Fix in order**: Domain rule → Orchestrator → Component
2. Make ONE change
3. Test: `npm test -- FileName`
4. Add regression test
5. Verify: `npm test && npm run build`

---

### Step 3: Complex Bugs

Create `docs/bugs/YYYY-MM-DD-description.md`:

```markdown
# [Bug Name]
**Date**: YYYY-MM-DD | **Status**: IN_PROGRESS | RESOLVED

## Problem
[How to reproduce]

## Investigation
- Domain: [files]
- Orchestrator: [files]
- Component: [files]
- Tests: [failing tests]

## Root Cause
[Why?]

## Plan
- [ ] Fix domain/orchestrator/component
- [ ] Add regression test
- [ ] Update docs (if needed)

## Changes
- `file.ts` - [what/why]

## Verification
- [ ] Tests pass
- [ ] Build succeeds
- [ ] User confirmed
```

---

### Step 4: Finish

1. Add regression test
2. Clean up debug code
3. Update docs (only if structure changed)
4. User confirms fix

---

## Priority Order

1. **Domain** (`src/domain/rules/`) - Pure logic, fix FIRST
2. **Orchestrator** (`src/services/orchestrators/`) - Coordination, fix SECOND
3. **Component** (`src/components/`) - UI only, fix LAST

---

## Quick Ref

- 547 tests = your map
- Read tests FIRST (show expected behavior)
- Complex bugs → `docs/bugs/`
- Fix order: domain → orchestrator → component
