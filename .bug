# Bug Fix Guide

**Context:** Read `.cursorrules` (patterns), `.architecture` (structure), `.ddd` (philosophy) first

---

## Step 1: Investigate & Summarize (DON'T FIX YET)

### Find the Code

```bash
# Business logic
grep -r "concept" src/domain/rules/

# Workflows
grep -r "concept" src/application/orchestrators/

# UI
grep -r "concept" src/presentation/components/

# Tests (shows expected behavior)
grep -r "describe.*concept" src/**/__tests__/
```

### Summarize

1. **What should happen?** (Business logic)
2. **Domain rules:** Which files? What constraints?
3. **Orchestrator:** Which file? What workflow?
4. **Component:** Which file? What UI behavior?
5. **Tests:** What do they expect? Are any failing?
6. **Gap:** Expected vs Actual behavior

**Offer 2-3 solutions** with pros/cons. **Wait for user feedback.**

---

## Step 2: Fix (After User Confirms)

### Priority Order

1. **Domain bug** → Fix in `domain/rules/` + add test
2. **Workflow bug** → Fix in `application/orchestrators/` + add test
3. **UI bug** → Fix in `presentation/components/` (test optional)

### Process

1. Make ONE change
2. Run tests: `npm test -- FileName`
3. Add regression test
4. Verify: `npm test && npm run build`

---

## Step 3: Complex Bugs

For multi-file or unclear bugs, create `docs/bugs/YYYY-MM-DD-description.md`:

```markdown
# [Bug Name]
**Date:** YYYY-MM-DD | **Status:** IN_PROGRESS | RESOLVED

## Problem
- Steps to reproduce
- Expected behavior
- Actual behavior

## Investigation
- **Domain:** [files checked]
- **Application:** [orchestrators checked]
- **Presentation:** [components checked]
- **Tests:** [failing tests, if any]

## Root Cause
[Why is this happening?]

## Solution Plan
- [ ] Fix domain/application/presentation
- [ ] Add regression test
- [ ] Update docs (if logic changed)

## Changes Made
- `file.ts` - [what changed and why]

## Verification
- [ ] Tests pass (`npm test`)
- [ ] Build succeeds (`npm run build`)
- [ ] User confirmed fix works
```

---

## Step 4: Finish

1. ✅ Add regression test
2. ✅ Remove debug code
3. ✅ Update docs (only if business logic changed)
4. ✅ User confirms fix

---

## Quick Reference

**Architecture:** 4 layers
- `domain/` - Pure business logic (fix FIRST)
- `application/` - Workflows (fix SECOND)
- `infrastructure/` - External dependencies
- `presentation/` - UI (fix LAST)

**Tests:** 547 tests = your map
- Read tests FIRST (they show expected behavior)
- Tests in `__tests__/` directories (co-located)
- Run: `npm test -- FileName`

**Complex bugs:** Create doc in `docs/bugs/`
