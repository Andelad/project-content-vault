<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Recurring Events - Manual Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .instructions { background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .step { margin: 10px 0; padding: 10px; border-left: 3px solid #007bff; }
        .expected { background: #e8f5e8; padding: 10px; border-radius: 5px; }
        .debug { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Manual Test for Recurring Events</h1>
    
    <div class="instructions">
        <h3>üß™ How to Test Recurring Events</h3>
        <p>Follow these steps to test if the recurring events fix is working:</p>
    </div>

    <div class="step">
        <h4>Step 1: Open the Application</h4>
        <p>1. Go to <a href="http://localhost:8083" target="_blank">http://localhost:8083</a></p>
        <p>2. Open Developer Tools (F12) and go to the Console tab</p>
        <p>3. Look for debug messages starting with "PlannerV2Context addEvent called with:"</p>
    </div>

    <div class="step">
        <h4>Step 2: Create a Recurring Event</h4>
        <p>1. Click to create a new event (click on a time slot)</p>
        <p>2. Fill in the event details:</p>
        <ul>
            <li><strong>Description:</strong> "Test Weekly Meeting"</li>
            <li><strong>Start/End:</strong> Any convenient time</li>
        </ul>
        <p>3. <strong>Important:</strong> Enable "Make this a recurring event" toggle</p>
        <p>4. Set recurrence to: <strong>Weekly, every 1 week, for 4 occurrences</strong></p>
        <p>5. Save the event</p>
    </div>

    <div class="step">
        <h4>Step 3: Check Console Output</h4>
        <div class="expected">
            <strong>Expected console output:</strong>
            <div class="debug">
PlannerV2Context addEvent called with: {recurring: {type: 'weekly', interval: 1, count: 4}, ...}
Creating recurring event: {type: 'weekly', interval: 1, count: 4}
Generated 4 recurring events with groupId: [some-uuid]
Creating recurring event 1/4: {title: 'Test Weekly Meeting', ...}
Created recurring event 1: [database response]
Creating recurring event 2/4: {title: 'Test Weekly Meeting', ...}
Created recurring event 2: [database response]
Creating recurring event 3/4: {title: 'Test Weekly Meeting', ...}
Created recurring event 3: [database response]
Creating recurring event 4/4: {title: 'Test Weekly Meeting', ...}
Created recurring event 4: [database response]
Successfully created 4 recurring events
Returning first event from recurring series: [event object]
            </div>
        </div>
    </div>

    <div class="step">
        <h4>Step 4: Verify Calendar Display</h4>
        <div class="expected">
            <strong>Expected result:</strong>
            <p>‚úÖ You should see <strong>4 separate events</strong> on the calendar, each exactly 1 week apart</p>
            <p>‚úÖ All events should have the same title: "Test Weekly Meeting"</p>
            <p>‚úÖ All events should be clickable and editable individually</p>
        </div>
    </div>

    <div class="step">
        <h4>Step 5: Test Deletion</h4>
        <p>1. Click on any recurring event to edit it</p>
        <p>2. Click "Delete Event"</p>
        <div class="expected">
            <strong>Expected result:</strong>
            <p>‚úÖ A dialog should appear with 3 options:</p>
            <ul>
                <li>"Just this event" - Deletes only the clicked event</li>
                <li>"This and future events" - Deletes from this event forward</li>
                <li>"All events in series" - Deletes all 4 events</li>
            </ul>
        </div>
    </div>

    <div class="step">
        <h4>üêõ If It's Not Working</h4>
        <p>Check the console for error messages. Common issues:</p>
        <ul>
            <li><strong>Import error:</strong> "Cannot import generateRecurringEvents"</li>
            <li><strong>Database error:</strong> SQL constraint violations</li>
            <li><strong>State error:</strong> Events created but not displayed</li>
            <li><strong>Authentication error:</strong> "User not authenticated"</li>
        </ul>
    </div>

    <div class="step">
        <h4>üîç Database Verification</h4>
        <p>To check if events are being saved to the database, run this in the browser console:</p>
        <div class="debug">
// Import supabase (should be available globally)
const { supabase } = await import('/src/integrations/supabase/client.js');

// Check all events
const { data: allEvents } = await supabase
  .from('calendar_events')
  .select('*')
  .order('start_time', { ascending: true });

console.log('All events:', allEvents);

// Check recurring events specifically
const { data: recurringEvents } = await supabase
  .from('calendar_events')
  .select('*')
  .not('recurring_group_id', 'is', null)
  .order('start_time', { ascending: true });

console.log('Recurring events:', recurringEvents);
        </div>
    </div>

    <h3>üéØ Success Criteria</h3>
    <div class="expected">
        <p><strong>The recurring events feature is working if:</strong></p>
        <ol>
            <li>Console shows debug messages for creating multiple events</li>
            <li>Calendar displays all recurring instances as separate events</li>
            <li>Each event can be clicked and edited individually</li>
            <li>Delete dialog offers the 3 deletion options</li>
            <li>Database contains all recurring events with proper grouping</li>
        </ol>
    </div>
</body>
</html>
